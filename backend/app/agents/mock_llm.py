"""
Mock LLM ì‘ë‹µ ìƒì„±ê¸°
ì‹¤ì œ API í‚¤ ì—†ì´ë„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ì‘ë‹µ ì‹œìŠ¤í…œ
"""

import random
import asyncio
from typing import Dict, List, AsyncGenerator
from datetime import datetime

class MockLLMResponse:
    """Mock LLM ì‘ë‹µ ìƒì„±"""
    
    # ë‹¤ì–‘í•œ í…Œë§ˆë³„ ì‘ë‹µ í…œí”Œë¦¿
    RESPONSE_TEMPLATES = {
        "greeting": [
            "ì•ˆë…•í•˜ì„¸ìš”! AI í¬íƒˆì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?",
            "ë°˜ê°‘ìŠµë‹ˆë‹¤! ì €ëŠ” AI í¬íƒˆì˜ ì¸ê³µì§€ëŠ¥ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
            "Hello! ì €ëŠ” ì—¬ëŸ¬ë¶„ì˜ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”.",
        ],
        "search": [
            "ğŸ” ê²€ìƒ‰ì„ ì‹œì‘í•©ë‹ˆë‹¤...\n\nê²€ìƒ‰ ê²°ê³¼ë¥¼ ë¶„ì„í•œ ê²°ê³¼, ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤:\n\nâ€¢ ê´€ë ¨ ë¬¸ì„œ 5ê°œ ë°œê²¬\nâ€¢ ìµœì‹  ì—…ë°ì´íŠ¸: 2ì¼ ì „\nâ€¢ ì‹ ë¢°ë„: ë†’ìŒ\n\nìì„¸í•œ ë‚´ìš©ì„ ì•Œë ¤ë“œë¦´ê¹Œìš”?",
            "ğŸŒ ì›¹ ê²€ìƒ‰ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.\n\nì£¼ìš” ë°œê²¬ì‚¬í•­:\nâœ… ê³µì‹ ë¬¸ì„œ 3ê±´\nâœ… ì»¤ë®¤ë‹ˆí‹° ë…¼ì˜ 7ê±´\nâœ… ìµœê·¼ ì—…ë°ì´íŠ¸ ë‚´ì—­\n\në” êµ¬ì²´ì ì¸ ì •ë³´ê°€ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”.",
            "ğŸ“Š ê²€ìƒ‰ ì™„ë£Œ!\n\nê²€ìƒ‰ì–´ì™€ ê´€ë ¨ëœ ì •ë³´ë¥¼ ì¢…í•©í•œ ê²°ê³¼:\n- í•µì‹¬ ê°œë… ì„¤ëª…\n- ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€\n- ê´€ë ¨ ë„êµ¬ ë° ë¦¬ì†ŒìŠ¤\n\nì–´ë–¤ ë¶€ë¶„ì„ ë” ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
        ],
        "help": [
            "ë„ì›€ì´ í•„ìš”í•˜ì‹œêµ°ìš”! ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:\n\nğŸ” ì›¹ ê²€ìƒ‰ ë° ì •ë³´ ì¡°íšŒ\nğŸ’¬ ìì—°ì–´ ëŒ€í™”\nğŸ“„ ë¬¸ì„œ ë¶„ì„ (ì˜ˆì •)\nğŸ¨ ì°½ì‘ ì§€ì›\n\nì–´ë–¤ ë„ì›€ì´ í•„ìš”í•˜ì‹ ì§€ êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ ì£¼ì„¸ìš”.",
            "AI í¬íƒˆì˜ ì£¼ìš” ê¸°ëŠ¥ë“¤ì„ ì†Œê°œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤:\n\nâ€¢ ì‹¤ì‹œê°„ ì •ë³´ ê²€ìƒ‰\nâ€¢ ë©€í‹°ëª¨ë‹¬ ë¶„ì„ (í…ìŠ¤íŠ¸, ì´ë¯¸ì§€)\nâ€¢ ì›Œí¬í”Œë¡œìš° ìë™í™”\nâ€¢ í˜‘ì—… ë„êµ¬ í†µí•©\n\nì§€ê¸ˆì€ Mock ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.",
            "ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¼ë“¤ì„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\nğŸ“ í…ìŠ¤íŠ¸ ì‘ì„± ë° í¸ì§‘\nğŸ” ì •ë³´ ê²€ìƒ‰ ë° ìš”ì•½\nğŸ’¡ ì•„ì´ë””ì–´ ì œì•ˆ\nğŸ› ï¸ ì½”ë”© ë° ê¸°ìˆ  ì§€ì›\n\në¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
        ],
        "technical": [
            "ê¸°ìˆ ì ì¸ ì§ˆë¬¸ì´êµ°ìš”! í˜„ì¬ Mock ëª¨ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì´ë¯€ë¡œ ì‹¤ì œ ì½”ë“œ ë¶„ì„ì€ ì œí•œì ì…ë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ ì¼ë°˜ì ì¸ ì ‘ê·¼ë²•ì„ ì œì•ˆë“œë¦¬ë©´:\n1. ë¬¸ì œ ìƒí™© íŒŒì•…\n2. ì†”ë£¨ì…˜ ì„¤ê³„\n3. ë‹¨ê³„ë³„ êµ¬í˜„\n4. í…ŒìŠ¤íŠ¸ ë° ê²€ì¦\n\nêµ¬ì²´ì ì¸ ê¸°ìˆ  ìŠ¤íƒì´ë‚˜ ë¬¸ì œì— ëŒ€í•´ ë” ìì„¸íˆ ë§ì”€í•´ ì£¼ì‹œë©´ ë„ì›€ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ğŸ”§ ê¸°ìˆ  ì§€ì› ëª¨ë“œì…ë‹ˆë‹¤.\n\ní˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœ:\n- Backend: FastAPI + SQLAlchemy\n- Frontend: React + TypeScript\n- Database: PostgreSQL\n- Cache: 2-tier (Memory + DB)\n\nì–´ë–¤ ê¸°ìˆ ì  ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?",
        ],
        "creative": [
            "ì°½ì‘ ëª¨ë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤! âœ¨\n\në‹¤ìŒê³¼ ê°™ì€ ì°½ì‘ ì‘ì—…ì„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\nâ€¢ ìŠ¤í† ë¦¬í…”ë§\nâ€¢ ë¸Œë ˆì¸ìŠ¤í† ë°\nâ€¢ ì½˜í…ì¸  ê¸°íš\nâ€¢ ì•„ì´ë””ì–´ ë°œì „\n\nì–´ë–¤ ì°½ì‘ë¬¼ì„ ë§Œë“¤ì–´ë³´ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
            "ğŸ¨ ì°½ì˜ì ì¸ ì‘ì—…ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤!\n\nì§€ê¸ˆê¹Œì§€ ë§ì€ ì‚¬ìš©ìë“¤ì´ ë‹¤ìŒê³¼ ê°™ì€ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤:\n- ì†Œì„¤ ë° ì‹œ ì°½ì‘\n- ë§ˆì¼€íŒ… ì¹´í”¼\n- í”„ë ˆì  í…Œì´ì…˜ ê¸°íš\n- ì œí’ˆ ì•„ì´ë””ì–´\n\nì–´ë–¤ ë¶„ì•¼ì— ê´€ì‹¬ì´ ìˆìœ¼ì‹œë‚˜ìš”?",
        ],
        "general": [
            "ë„¤, ì´í•´í–ˆìŠµë‹ˆë‹¤. ì¡°ê¸ˆ ë” êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\nê´€ë ¨ ì •ë³´ë“¤ì„ ì¢…í•©í•´ë³´ë©´, ì—¬ëŸ¬ ì ‘ê·¼ ë°©ë²•ì´ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ìƒí™©ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ì§„í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤:\n\n1. í˜„ì¬ ìƒí™© ë¶„ì„\n2. ëª©í‘œ ì„¤ì •\n3. ì‹¤í–‰ ê³„íš ìˆ˜ë¦½\n4. ë‹¨ê³„ë³„ ì‹¤í–‰\n\në” êµ¬ì²´ì ì¸ ì¡°ì–¸ì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”!",
            "ì¢‹ì€ ì§ˆë¬¸ì´ë„¤ìš”! ì´ëŸ° ìƒí™©ì—ì„œëŠ” ì—¬ëŸ¬ ê´€ì ì—ì„œ ìƒê°í•´ë³¼ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.\n\nì œê°€ ì¶”ì²œë“œë¦¬ëŠ” ì ‘ê·¼ë²•ì€:\nâ€¢ ë°ì´í„° ìˆ˜ì§‘ ë° ë¶„ì„\nâ€¢ ë‹¤ì–‘í•œ ì˜µì…˜ ê²€í† \nâ€¢ ì¥ë‹¨ì  ë¹„êµ\nâ€¢ ìµœì  ì†”ë£¨ì…˜ ì„ íƒ\n\ní˜¹ì‹œ íŠ¹ë³„íˆ ê³ ë ¤í•´ì•¼ í•  ì œì•½ì‚¬í•­ì´ë‚˜ ìš”êµ¬ì‚¬í•­ì´ ìˆìœ¼ì‹ ê°€ìš”?",
            "í¥ë¯¸ë¡œìš´ ì£¼ì œì…ë‹ˆë‹¤! ì´ì— ëŒ€í•´ ì—¬ëŸ¬ ê°ë„ì—ì„œ ì‚´í´ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\n\ní˜„ì¬ íŠ¸ë Œë“œì™€ ëª¨ë²” ì‚¬ë¡€ë¥¼ ê³ ë ¤í•  ë•Œ, ë‹¤ìŒê³¼ ê°™ì€ ë°©í–¥ì´ íš¨ê³¼ì ì¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤:\n\nâœ… ì‚¬ìš©ì ê²½í—˜ ì¤‘ì‹¬ ì ‘ê·¼\nâœ… í™•ì¥ ê°€ëŠ¥í•œ ì„¤ê³„\nâœ… ì§€ì† ê°€ëŠ¥í•œ ì†”ë£¨ì…˜\n\nì–´ë–¤ ë¶€ë¶„ì— ëŒ€í•´ ë” ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
        ]
    }
    
    @classmethod
    def classify_query(cls, query: str) -> str:
        """ì¿¼ë¦¬ ìœ í˜• ë¶„ë¥˜"""
        query_lower = query.lower()
        
        # ì¸ì‚¬ë§
        if any(word in query_lower for word in ['ì•ˆë…•', 'hello', 'hi', 'ë°˜ê°€']):
            return "greeting"
        
        # ê²€ìƒ‰ ê´€ë ¨
        if any(word in query_lower for word in ['ê²€ìƒ‰', 'search', 'ì°¾', 'ì•Œë ¤ì¤˜', 'ì •ë³´']):
            return "search"
        
        # ë„ì›€ë§
        if any(word in query_lower for word in ['ë„ì›€', 'help', 'ê¸°ëŠ¥', 'ë­˜', 'ì–´ë–»ê²Œ']):
            return "help"
        
        # ê¸°ìˆ  ê´€ë ¨
        if any(word in query_lower for word in ['ì½”ë“œ', 'code', 'í”„ë¡œê·¸ë˜ë°', 'ê°œë°œ', 'ê¸°ìˆ ', 'ë²„ê·¸', 'error']):
            return "technical"
        
        # ì°½ì‘ ê´€ë ¨
        if any(word in query_lower for word in ['ì‘ì„±', 'ì¨ì¤˜', 'ë§Œë“¤ì–´', 'ì°½ì‘', 'ì•„ì´ë””ì–´', 'ê¸°íš']):
            return "creative"
        
        return "general"
    
    @classmethod
    def generate_response(cls, query: str, model: str = "mock-llm") -> str:
        """Mock ì‘ë‹µ ìƒì„±"""
        query_type = cls.classify_query(query)
        templates = cls.RESPONSE_TEMPLATES.get(query_type, cls.RESPONSE_TEMPLATES["general"])
        
        # ëœë¤í•˜ê²Œ ì‘ë‹µ ì„ íƒ
        response = random.choice(templates)
        
        # ë©”íƒ€ë°ì´í„° ì¶”ê°€
        if model and "mock" in model.lower():
            footer = f"\n\n---\nğŸ’¡ *Mock ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ {model.replace('mock-', '').upper()} APIë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.*"
            response += footer
        
        return response
    
    @classmethod
    async def stream_response(cls, query: str, model: str = "mock-llm") -> AsyncGenerator[str, None]:
        """ìŠ¤íŠ¸ë¦¬ë° Mock ì‘ë‹µ ìƒì„±"""
        response = cls.generate_response(query, model)
        
        # ë‹¨ì–´ë³„ë¡œ ìŠ¤íŠ¸ë¦¬ë° (ì‹¤ì œ LLM ë™ì‘ ì‹œë®¬ë ˆì´ì…˜)
        words = response.split()
        
        for i, word in enumerate(words):
            # ë§ˆì§€ë§‰ ë‹¨ì–´ê°€ ì•„ë‹Œ ê²½ìš° ê³µë°± ì¶”ê°€
            chunk = word + (" " if i < len(words) - 1 else "")
            yield chunk
            
            # ìŠ¤íŠ¸ë¦¬ë° ë”œë ˆì´ (ì‹¤ì œ LLM ëŠë‚Œ)
            await asyncio.sleep(random.uniform(0.02, 0.08))
    
    @classmethod
    def get_model_info(cls, model: str) -> Dict:
        """Mock ëª¨ë¸ ì •ë³´"""
        mock_models = {
            "mock-claude": {
                "name": "Mock Claude 3 Haiku",
                "provider": "Mock Anthropic",
                "max_tokens": 4096,
                "supports_streaming": True,
                "cost_per_1k_tokens": 0.00
            },
            "mock-gemini": {
                "name": "Mock Gemini Pro",
                "provider": "Mock Google",
                "max_tokens": 8192,
                "supports_streaming": True,
                "cost_per_1k_tokens": 0.00
            },
            "mock-gpt": {
                "name": "Mock GPT-4",
                "provider": "Mock OpenAI",
                "max_tokens": 8192,
                "supports_streaming": True,
                "cost_per_1k_tokens": 0.00
            }
        }
        
        return mock_models.get(model, mock_models["mock-claude"])


# ì „ì—­ Mock LLM ì¸ìŠ¤í„´ìŠ¤
mock_llm = MockLLMResponse()