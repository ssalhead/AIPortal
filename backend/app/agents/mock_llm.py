"""
Mock LLM ÏùëÎãµ ÏÉùÏÑ±Í∏∞
Ïã§Ï†ú API ÌÇ§ ÏóÜÏù¥ÎèÑ ÌÖåÏä§Ìä∏ Í∞ÄÎä•Ìïú ÏùëÎãµ ÏãúÏä§ÌÖú
"""

import random
import asyncio
from typing import Dict, List, AsyncGenerator
from datetime import datetime

class MockLLMResponse:
    """Mock LLM ÏùëÎãµ ÏÉùÏÑ±"""
    
    # Îã§ÏñëÌïú ÌÖåÎßàÎ≥Ñ ÏùëÎãµ ÌÖúÌîåÎ¶ø
    RESPONSE_TEMPLATES = {
        "greeting": [
            "ÏïàÎÖïÌïòÏÑ∏Ïöî! AI Ìè¨ÌÉàÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§. Ïñ¥ÎñªÍ≤å ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî?",
            "Î∞òÍ∞ëÏäµÎãàÎã§! Ï†ÄÎäî AI Ìè¨ÌÉàÏùò Ïù∏Í≥µÏßÄÎä• Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ÏûÖÎãàÎã§. Î¨¥ÏóáÏùÑ ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî?",
            "Hello! Ï†ÄÎäî Ïó¨Îü¨Î∂ÑÏùò AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ÏûÖÎãàÎã§. Í∂ÅÍ∏àÌïú Í≤ÉÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî.",
        ],
        "search": [
            "üîç Í≤ÄÏÉâÏùÑ ÏãúÏûëÌï©ÎãàÎã§...\n\nÍ≤ÄÏÉâ Í≤∞Í≥ºÎ•º Î∂ÑÏÑùÌïú Í≤∞Í≥º, Îã§ÏùåÍ≥º Í∞ôÏùÄ Ï†ïÎ≥¥Î•º Ï∞æÏïòÏäµÎãàÎã§:\n\n‚Ä¢ Í¥ÄÎ†® Î¨∏ÏÑú 5Í∞ú Î∞úÍ≤¨\n‚Ä¢ ÏµúÏã† ÏóÖÎç∞Ïù¥Ìä∏: 2Ïùº Ï†Ñ\n‚Ä¢ Ïã†Î¢∞ÎèÑ: ÎÜíÏùå\n\nÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÑ ÏïåÎ†§ÎìúÎ¶¥ÍπåÏöî?",
            "üåê Ïõπ Í≤ÄÏÉâÏùÑ ÏàòÌñâÌñàÏäµÎãàÎã§.\n\nÏ£ºÏöî Î∞úÍ≤¨ÏÇ¨Ìï≠:\n‚úÖ Í≥µÏãù Î¨∏ÏÑú 3Í±¥\n‚úÖ Ïª§ÎÆ§ÎãàÌã∞ ÎÖºÏùò 7Í±¥\n‚úÖ ÏµúÍ∑º ÏóÖÎç∞Ïù¥Ìä∏ ÎÇ¥Ïó≠\n\nÎçî Íµ¨Ï≤¥Ï†ÅÏù∏ Ï†ïÎ≥¥Í∞Ä ÌïÑÏöîÌïòÏãúÎ©¥ ÎßêÏîÄÌï¥ Ï£ºÏÑ∏Ïöî.",
            "üìä Í≤ÄÏÉâ ÏôÑÎ£å!\n\nÍ≤ÄÏÉâÏñ¥ÏôÄ Í¥ÄÎ†®Îêú Ï†ïÎ≥¥Î•º Ï¢ÖÌï©Ìïú Í≤∞Í≥º:\n- ÌïµÏã¨ Í∞úÎÖê ÏÑ§Î™Ö\n- Ïã§Ï†ú ÏÇ¨Ïö© ÏÇ¨Î°Ä\n- Í¥ÄÎ†® ÎèÑÍµ¨ Î∞è Î¶¨ÏÜåÏä§\n\nÏñ¥Îñ§ Î∂ÄÎ∂ÑÏùÑ Îçî ÏûêÏÑ∏Ìûà ÏïåÍ≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?",
        ],
        "help": [
            "ÎèÑÏõÄÏù¥ ÌïÑÏöîÌïòÏãúÍµ∞Ïöî! Îã§ÏùåÍ≥º Í∞ôÏùÄ Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§:\n\nüîç Ïõπ Í≤ÄÏÉâ Î∞è Ï†ïÎ≥¥ Ï°∞Ìöå\nüí¨ ÏûêÏó∞Ïñ¥ ÎåÄÌôî\nüìÑ Î¨∏ÏÑú Î∂ÑÏÑù (ÏòàÏ†ï)\nüé® Ï∞ΩÏûë ÏßÄÏõê\n\nÏñ¥Îñ§ ÎèÑÏõÄÏù¥ ÌïÑÏöîÌïòÏã†ÏßÄ Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÎßêÏîÄÌï¥ Ï£ºÏÑ∏Ïöî.",
            "AI Ìè¨ÌÉàÏùò Ï£ºÏöî Í∏∞Îä•Îì§ÏùÑ ÏÜåÍ∞úÌï¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§:\n\n‚Ä¢ Ïã§ÏãúÍ∞Ñ Ï†ïÎ≥¥ Í≤ÄÏÉâ\n‚Ä¢ Î©ÄÌã∞Î™®Îã¨ Î∂ÑÏÑù (ÌÖçÏä§Ìä∏, Ïù¥ÎØ∏ÏßÄ)\n‚Ä¢ ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏûêÎèôÌôî\n‚Ä¢ ÌòëÏóÖ ÎèÑÍµ¨ ÌÜµÌï©\n\nÏßÄÍ∏àÏùÄ Mock Î™®ÎìúÎ°ú Ïã§Ìñâ Ï§ëÏûÖÎãàÎã§. Ïã§Ï†ú Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ API ÌÇ§Î•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.",
            "ÏïàÎÖïÌïòÏÑ∏Ïöî! Ï†ÄÎäî Îã§ÏùåÍ≥º Í∞ôÏùÄ ÏùºÎì§ÏùÑ ÎèÑÏôÄÎìúÎ¶¥ Ïàò ÏûàÏäµÎãàÎã§:\n\nüìù ÌÖçÏä§Ìä∏ ÏûëÏÑ± Î∞è Ìé∏Ïßë\nüîé Ï†ïÎ≥¥ Í≤ÄÏÉâ Î∞è ÏöîÏïΩ\nüí° ÏïÑÏù¥ÎîîÏñ¥ Ï†úÏïà\nüõ†Ô∏è ÏΩîÎî© Î∞è Í∏∞Ïà† ÏßÄÏõê\n\nÎ¨¥ÏóáÏùÑ ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî?",
        ],
        "technical": [
            "Í∏∞Ïà†Ï†ÅÏù∏ ÏßàÎ¨∏Ïù¥Íµ∞Ïöî! ÌòÑÏû¨ Mock Î™®ÎìúÏóêÏÑú Ïã§Ìñâ Ï§ëÏù¥ÎØÄÎ°ú Ïã§Ï†ú ÏΩîÎìú Î∂ÑÏÑùÏùÄ Ï†úÌïúÏ†ÅÏûÖÎãàÎã§.\n\nÌïòÏßÄÎßå ÏùºÎ∞òÏ†ÅÏù∏ Ï†ëÍ∑ºÎ≤ïÏùÑ Ï†úÏïàÎìúÎ¶¨Î©¥:\n1. Î¨∏Ï†ú ÏÉÅÌô© ÌååÏïÖ\n2. ÏÜîÎ£®ÏÖò ÏÑ§Í≥Ñ\n3. Îã®Í≥ÑÎ≥Ñ Íµ¨ÌòÑ\n4. ÌÖåÏä§Ìä∏ Î∞è Í≤ÄÏ¶ù\n\nÍµ¨Ï≤¥Ï†ÅÏù∏ Í∏∞Ïà† Ïä§ÌÉùÏù¥ÎÇò Î¨∏Ï†úÏóê ÎåÄÌï¥ Îçî ÏûêÏÑ∏Ìûà ÎßêÏîÄÌï¥ Ï£ºÏãúÎ©¥ ÎèÑÏõÄÏùÑ ÎìúÎ¶¥ Ïàò ÏûàÏäµÎãàÎã§.",
            "üîß Í∏∞Ïà† ÏßÄÏõê Î™®ÎìúÏûÖÎãàÎã§.\n\nÌòÑÏû¨ ÏãúÏä§ÌÖú ÏÉÅÌÉú:\n- Backend: FastAPI + SQLAlchemy\n- Frontend: React + TypeScript\n- Database: PostgreSQL\n- Cache: 2-tier (Memory + DB)\n\nÏñ¥Îñ§ Í∏∞Ïà†Ï†Å ÎèÑÏõÄÏù¥ ÌïÑÏöîÌïòÏã†Í∞ÄÏöî?",
        ],
        "creative": [
            "Ï∞ΩÏûë Î™®ÎìúÎ•º ÏãúÏûëÌï©ÎãàÎã§! ‚ú®\n\nÎã§ÏùåÍ≥º Í∞ôÏùÄ Ï∞ΩÏûë ÏûëÏóÖÏùÑ ÎèÑÏôÄÎìúÎ¶¥ Ïàò ÏûàÏäµÎãàÎã§:\n‚Ä¢ Ïä§ÌÜ†Î¶¨ÌÖîÎßÅ\n‚Ä¢ Î∏åÎ†àÏù∏Ïä§ÌÜ†Î∞ç\n‚Ä¢ ÏΩòÌÖêÏ∏† Í∏∞Ìöç\n‚Ä¢ ÏïÑÏù¥ÎîîÏñ¥ Î∞úÏ†Ñ\n\nÏñ¥Îñ§ Ï∞ΩÏûëÎ¨ºÏùÑ ÎßåÎì§Ïñ¥Î≥¥Í≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?",
            "üé® Ï∞ΩÏùòÏ†ÅÏù∏ ÏûëÏóÖÏùÑ ÎèÑÏôÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§!\n\nÏßÄÍ∏àÍπåÏßÄ ÎßéÏùÄ ÏÇ¨Ïö©ÏûêÎì§Ïù¥ Îã§ÏùåÍ≥º Í∞ôÏùÄ ÌîÑÎ°úÏ†ùÌä∏Î•º ÏßÑÌñâÌñàÏäµÎãàÎã§:\n- ÏÜåÏÑ§ Î∞è Ïãú Ï∞ΩÏûë\n- ÎßàÏºÄÌåÖ Ïπ¥Ìîº\n- ÌîÑÎ†àÏ††ÌÖåÏù¥ÏÖò Í∏∞Ìöç\n- Ï†úÌíà ÏïÑÏù¥ÎîîÏñ¥\n\nÏñ¥Îñ§ Î∂ÑÏïºÏóê Í¥ÄÏã¨Ïù¥ ÏûàÏúºÏãúÎÇòÏöî?",
        ],
        "general": [
            "ÎÑ§, Ïù¥Ìï¥ÌñàÏäµÎãàÎã§. Ï°∞Í∏à Îçî Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÏÑ§Î™ÖÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.\n\nÍ¥ÄÎ†® Ï†ïÎ≥¥Îì§ÏùÑ Ï¢ÖÌï©Ìï¥Î≥¥Î©¥, Ïó¨Îü¨ Ï†ëÍ∑º Î∞©Î≤ïÏù¥ ÏûàÏùÑ Í≤É Í∞ôÏäµÎãàÎã§. ÏÉÅÌô©Ïóê Îî∞Îùº Îã§Î•¥ÏßÄÎßå, ÏùºÎ∞òÏ†ÅÏúºÎ°úÎäî Îã§ÏùåÍ≥º Í∞ôÏùÄ ÏàúÏÑúÎ°ú ÏßÑÌñâÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§:\n\n1. ÌòÑÏû¨ ÏÉÅÌô© Î∂ÑÏÑù\n2. Î™©Ìëú ÏÑ§Ï†ï\n3. Ïã§Ìñâ Í≥ÑÌöç ÏàòÎ¶Ω\n4. Îã®Í≥ÑÎ≥Ñ Ïã§Ìñâ\n\nÎçî Íµ¨Ï≤¥Ï†ÅÏù∏ Ï°∞Ïñ∏Ïù¥ ÌïÑÏöîÌïòÏãúÎ©¥ ÎßêÏîÄÌï¥ Ï£ºÏÑ∏Ïöî!",
            "Ï¢ãÏùÄ ÏßàÎ¨∏Ïù¥ÎÑ§Ïöî! Ïù¥Îü∞ ÏÉÅÌô©ÏóêÏÑúÎäî Ïó¨Îü¨ Í¥ÄÏ†êÏóêÏÑú ÏÉùÍ∞ÅÌï¥Î≥º ÌïÑÏöîÍ∞Ä ÏûàÏäµÎãàÎã§.\n\nÏ†úÍ∞Ä Ï∂îÏ≤úÎìúÎ¶¨Îäî Ï†ëÍ∑ºÎ≤ïÏùÄ:\n‚Ä¢ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Î∞è Î∂ÑÏÑù\n‚Ä¢ Îã§ÏñëÌïú ÏòµÏÖò Í≤ÄÌÜ†\n‚Ä¢ Ïû•Îã®Ï†ê ÎπÑÍµê\n‚Ä¢ ÏµúÏ†Å ÏÜîÎ£®ÏÖò ÏÑ†ÌÉù\n\nÌòπÏãú ÌäπÎ≥ÑÌûà Í≥†Î†§Ìï¥Ïïº Ìï† Ï†úÏïΩÏÇ¨Ìï≠Ïù¥ÎÇò ÏöîÍµ¨ÏÇ¨Ìï≠Ïù¥ ÏûàÏúºÏã†Í∞ÄÏöî?",
            "Ìù•ÎØ∏Î°úÏö¥ Ï£ºÏ†úÏûÖÎãàÎã§! Ïù¥Ïóê ÎåÄÌï¥ Ïó¨Îü¨ Í∞ÅÎèÑÏóêÏÑú ÏÇ¥Ìé¥Î≥º Ïàò ÏûàÏùÑ Í≤É Í∞ôÏäµÎãàÎã§.\n\nÌòÑÏû¨ Ìä∏Î†åÎìúÏôÄ Î™®Î≤î ÏÇ¨Î°ÄÎ•º Í≥†Î†§Ìï† Îïå, Îã§ÏùåÍ≥º Í∞ôÏùÄ Î∞©Ìñ•Ïù¥ Ìö®Í≥ºÏ†ÅÏùº Í≤É Í∞ôÏäµÎãàÎã§:\n\n‚úÖ ÏÇ¨Ïö©Ïûê Í≤ΩÌóò Ï§ëÏã¨ Ï†ëÍ∑º\n‚úÖ ÌôïÏû• Í∞ÄÎä•Ìïú ÏÑ§Í≥Ñ\n‚úÖ ÏßÄÏÜç Í∞ÄÎä•Ìïú ÏÜîÎ£®ÏÖò\n\nÏñ¥Îñ§ Î∂ÄÎ∂ÑÏóê ÎåÄÌï¥ Îçî ÏûêÏÑ∏Ìûà ÏïåÍ≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?",
        ]
    }
    
    @classmethod
    def classify_query(cls, query: str) -> str:
        """ÏøºÎ¶¨ Ïú†Ìòï Î∂ÑÎ•ò"""
        query_lower = query.lower()
        
        # Ïù∏ÏÇ¨Îßê
        if any(word in query_lower for word in ['ÏïàÎÖï', 'hello', 'hi', 'Î∞òÍ∞Ä']):
            return "greeting"
        
        # Í≤ÄÏÉâ Í¥ÄÎ†®
        if any(word in query_lower for word in ['Í≤ÄÏÉâ', 'search', 'Ï∞æ', 'ÏïåÎ†§Ï§ò', 'Ï†ïÎ≥¥']):
            return "search"
        
        # ÎèÑÏõÄÎßê
        if any(word in query_lower for word in ['ÎèÑÏõÄ', 'help', 'Í∏∞Îä•', 'Î≠ò', 'Ïñ¥ÎñªÍ≤å']):
            return "help"
        
        # Í∏∞Ïà† Í¥ÄÎ†®
        if any(word in query_lower for word in ['ÏΩîÎìú', 'code', 'ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç', 'Í∞úÎ∞ú', 'Í∏∞Ïà†', 'Î≤ÑÍ∑∏', 'error']):
            return "technical"
        
        # Ï∞ΩÏûë Í¥ÄÎ†®
        if any(word in query_lower for word in ['ÏûëÏÑ±', 'Ïç®Ï§ò', 'ÎßåÎì§Ïñ¥', 'Ï∞ΩÏûë', 'ÏïÑÏù¥ÎîîÏñ¥', 'Í∏∞Ìöç']):
            return "creative"
        
        return "general"
    
    @classmethod
    def generate_response(cls, query: str, model: str = "mock-llm") -> str:
        """Mock ÏùëÎãµ ÏÉùÏÑ±"""
        query_type = cls.classify_query(query)
        templates = cls.RESPONSE_TEMPLATES.get(query_type, cls.RESPONSE_TEMPLATES["general"])
        
        # ÎûúÎç§ÌïòÍ≤å ÏùëÎãµ ÏÑ†ÌÉù
        response = random.choice(templates)
        
        # Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
        if model and "mock" in model.lower():
            footer = f"\n\n---\nüí° *Mock Î™®ÎìúÎ°ú Ïã§Ìñâ Ï§ëÏûÖÎãàÎã§. Ïã§Ï†ú {model.replace('mock-', '').upper()} APIÎ•º ÏÇ¨Ïö©ÌïòÎ†§Î©¥ API ÌÇ§Î•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.*"
            response += footer
        
        return response
    
    @classmethod
    async def stream_response(cls, query: str, model: str = "mock-llm") -> AsyncGenerator[str, None]:
        """Ïä§Ìä∏Î¶¨Î∞ç Mock ÏùëÎãµ ÏÉùÏÑ± (Ï§ÑÎ∞îÍøà Ìè¨Ìï®)"""
        response = cls.generate_response(query, model)
        
        # Î¨∏Ïû•Î≥ÑÎ°ú Ïä§Ìä∏Î¶¨Î∞ç (Ï§ÑÎ∞îÍøà Ìè¨Ìï® Ï≤≠ÌÅ¨)
        import re
        
        # Î¨∏Ïû•Í≥º Ï§ÑÎ∞îÍøàÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Ï≤≠ÌÅ¨ Î∂ÑÌï†
        chunks = []
        lines = response.split('\n')
        
        for line in lines:
            if line.strip():
                # Í∏¥ Ï§ÑÏùÄ Î¨∏Ïû•ÏúºÎ°ú Î∂ÑÌï†
                sentences = re.split(r'([.!?]\s+)', line)
                current_chunk = ""
                
                for sentence in sentences:
                    current_chunk += sentence
                    if len(current_chunk) > 30 or sentence.endswith(('.', '!', '?')):
                        if current_chunk.strip():
                            chunks.append(current_chunk)
                            current_chunk = ""
                
                if current_chunk.strip():
                    chunks.append(current_chunk)
            else:
                # Îπà Ï§ÑÏùÄ Ï§ÑÎ∞îÍøàÏúºÎ°ú Ï∂îÍ∞Ä
                chunks.append('\n')
        
        # Ï≤≠ÌÅ¨Î≥ÑÎ°ú Ïä§Ìä∏Î¶¨Î∞ç
        for i, chunk in enumerate(chunks):
            if i < len(chunks) - 1 and not chunk.endswith('\n'):
                chunk += '\n'  # Ï§ÑÎ∞îÍøà Ï∂îÍ∞Ä
            
            yield chunk
            
            # Ïä§Ìä∏Î¶¨Î∞ç ÎîúÎ†àÏù¥ (Ïã§Ï†ú LLM ÎäêÎÇå)
            await asyncio.sleep(random.uniform(0.02, 0.08))
    
    @classmethod
    def get_model_info(cls, model: str) -> Dict:
        """Mock Î™®Îç∏ Ï†ïÎ≥¥"""
        mock_models = {
            "mock-claude": {
                "name": "Mock Claude 3 Haiku",
                "provider": "Mock Anthropic",
                "max_tokens": 4096,
                "supports_streaming": True,
                "cost_per_1k_tokens": 0.00
            },
            "mock-gemini": {
                "name": "Mock Gemini Pro",
                "provider": "Mock Google",
                "max_tokens": 8192,
                "supports_streaming": True,
                "cost_per_1k_tokens": 0.00
            },
            "mock-gpt": {
                "name": "Mock GPT-4",
                "provider": "Mock OpenAI",
                "max_tokens": 8192,
                "supports_streaming": True,
                "cost_per_1k_tokens": 0.00
            }
        }
        
        return mock_models.get(model, mock_models["mock-claude"])


# Ï†ÑÏó≠ Mock LLM Ïù∏Ïä§ÌÑ¥Ïä§
mock_llm = MockLLMResponse()